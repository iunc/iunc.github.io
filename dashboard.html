<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <style>
  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 20px;
    background: #0f0f0f;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  }

  h2 {
    text-align: center;
  }

  textarea {
    width: 100%;
    min-height: 100px;
    padding: 14px;
    background: #262626;
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 16px;
  }

  button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    background: #3b82f6;
    border: none;
    border-radius: 10px;
    color: white;
    font-weight: bold;
  }

  .note {
    background: #1a1a1a;
    padding: 15px;
    margin-top: 12px;
    border-radius: 12px;
    word-wrap: break-word;
  }
  </style>
</head>
<body>

<h2>My Notes</h2>
<textarea id="noteInput" placeholder="Write something..."></textarea>
<button onclick="addNote()">Save</button>
<button onclick="logout()">Logout</button>

<div id="notes"></div>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    loadNotes(user.uid);
  }
});

window.logout = function () {
  signOut(auth).then(() => {
    window.location.href = "login.html";
  });
};

window.addNote = async function () {
  const user = auth.currentUser;
  const text = document.getElementById("noteInput").value;

  await addDoc(collection(db, "users", user.uid, "notes"), {
    text: text,
  });

  location.reload();
};

async function loadNotes(uid) {
  const querySnapshot = await getDocs(collection(db, "users", uid, "notes"));
  const container = document.getElementById("notes");
  querySnapshot.forEach((doc) => {
    const div = document.createElement("div");
    div.className = "note";
    div.innerText = doc.data().text;
    container.appendChild(div);
  });
}
</script>

</body>
</html>
