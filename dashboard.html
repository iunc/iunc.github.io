<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <style>
    body {
      background: #121212;
      color: white;
      font-family: sans-serif;
      padding: 20px;
    }
    textarea {
      width: 100%;
      height: 80px;
      background: #2c2c2c;
      color: white;
      border: none;
      padding: 10px;
    }
    button {
      padding: 8px 15px;
      margin-top: 10px;
      background: #4caf50;
      border: none;
      color: white;
      cursor: pointer;
    }
    .note {
      background: #1e1e1e;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<h2>My Notes</h2>
<textarea id="noteInput" placeholder="Write something..."></textarea>
<button onclick="addNote()">Save</button>
<button onclick="logout()">Logout</button>

<div id="notes"></div>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    loadNotes(user.uid);
  }
});

window.logout = function () {
  signOut(auth).then(() => {
    window.location.href = "login.html";
  });
};

window.addNote = async function () {
  const user = auth.currentUser;
  const text = document.getElementById("noteInput").value;

  await addDoc(collection(db, "users", user.uid, "notes"), {
    text: text,
  });

  location.reload();
};

async function loadNotes(uid) {
  const querySnapshot = await getDocs(collection(db, "users", uid, "notes"));
  const container = document.getElementById("notes");
  querySnapshot.forEach((doc) => {
    const div = document.createElement("div");
    div.className = "note";
    div.innerText = doc.data().text;
    container.appendChild(div);
  });
}
</script>

</body>
</html>
